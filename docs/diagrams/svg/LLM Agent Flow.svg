<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2932px" preserveAspectRatio="none" style="width:3154px;height:2932px;background:#FEFEFE;" version="1.1" viewBox="0 0 3154 2932" width="3154px" zoomAndPan="magnify"><defs/><g><rect fill="#FEFEFE" height="2932" style="stroke:none;stroke-width:1.0;" width="3154" x="0" y="0"/><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="651" x="1247" y="37.1182">LLM Handler and Agent Flow with Context Variables</text><!--cluster Initialization Phase--><g id="cluster_Initialization Phase"><path d="M250,805.2373 L393,805.2373 A7.5,7.5 0 0 1 398,810.2373 L405,828.252 L693,828.252 A5,5 0 0 1 698,833.252 L698,1656.7373 A5,5 0 0 1 693,1661.7373 L250,1661.7373 A5,5 0 0 1 245,1656.7373 L245,810.2373 A5,5 0 0 1 250,805.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="245" x2="405" y1="828.252" y2="828.252"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="147" x="249" y="821.3125">Initialization Phase</text></g><!--cluster LLMHandler--><g id="cluster_LLMHandler"><rect fill="#FFFFFF" height="348" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="389" x="277" y="977.7373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="91" x="426" y="993.8125">LLMHandler</text><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="131" x="406" y="1010.8271">(llm_handler.py)</text></g><!--cluster AgentGraph--><g id="cluster_AgentGraph"><rect fill="#FFFFFF" height="237" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="363" x="290" y="1392.7373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="98" x="422.5" y="1408.8125">Agent Graph</text><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="84" x="429.5" y="1425.8271">(agent.py)</text></g><!--cluster Message Processing Flow--><g id="cluster_Message Processing Flow"><path d="M1779,1372.2373 L1972,1372.2373 A7.5,7.5 0 0 1 1977,1377.2373 L1984,1395.252 L2182,1395.252 A5,5 0 0 1 2187,1400.252 L2187,2051.7373 A5,5 0 0 1 2182,2056.7373 L1779,2056.7373 A5,5 0 0 1 1774,2051.7373 L1774,1377.2373 A5,5 0 0 1 1779,1372.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1774" x2="1984" y1="1395.252" y2="1395.252"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="197" x="1778" y="1388.3125">Message Processing Flow</text></g><!--cluster MessageHandler--><g id="cluster_MessageHandler"><rect fill="#FFFFFF" height="174" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="343" x="1812" y="1424.2373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="126" x="1920.5" y="1440.3125">MessageHandler</text><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="153" x="1907" y="1457.3271">(base_handlers.py)</text></g><!--cluster GetResponseAPI--><g id="cluster_GetResponseAPI"><rect fill="#FFFFFF" height="331" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="349" x="1806" y="1693.7373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="155" x="1903" y="1709.8125">get_response_api()</text></g><!--cluster System Message Context Variables--><g id="cluster_System Message Context Variables"><path d="M1764,2080.7373 L2029,2080.7373 A7.5,7.5 0 0 1 2034,2085.7373 L2041,2103.752 L2227,2103.752 A5,5 0 0 1 2232,2108.752 L2232,2905.2373 A5,5 0 0 1 2227,2910.2373 L1764,2910.2373 A5,5 0 0 1 1759,2905.2373 L1759,2085.7373 A5,5 0 0 1 1764,2080.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1759" x2="2041" y1="2103.752" y2="2103.752"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="269" x="1763" y="2096.8125">System Message Context Variables</text></g><!--cluster SystemMsg--><g id="cluster_SystemMsg"><rect fill="#FFFFFF" height="473" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="409" x="1791" y="2132.7373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="205" x="1893" y="2148.8125">System Message Structure</text></g><!--cluster MsgList--><g id="cluster_MsgList"><rect fill="#FFFFFF" height="173" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="383" x="1804" y="2705.2373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="203" x="1894" y="2721.3125">Message List Construction</text></g><!--cluster Agent State Variables--><g id="cluster_Agent State Variables"><path d="M2261,2637.7373 L2424,2637.7373 A7.5,7.5 0 0 1 2429,2642.7373 L2436,2660.752 L2675,2660.752 A5,5 0 0 1 2680,2665.752 L2680,2920.7373 A5,5 0 0 1 2675,2925.7373 L2261,2925.7373 A5,5 0 0 1 2256,2920.7373 L2256,2642.7373 A5,5 0 0 1 2261,2637.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="2256" x2="2436" y1="2660.752" y2="2660.752"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="167" x="2260" y="2653.8125">Agent State Variables</text></g><!--cluster AgentState--><g id="cluster_AgentState"><rect fill="#FFFFFF" height="220" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="376" x="2280" y="2681.7373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="184" x="2376" y="2697.8125">AgentState (TypedDict)</text></g><!--cluster Agent Graph Execution Flow--><g id="cluster_Agent Graph Execution Flow"><path d="M1176,58.7373 L1393,58.7373 A7.5,7.5 0 0 1 1398,63.7373 L1405,81.752 L1735,81.752 A5,5 0 0 1 1740,86.752 L1740,1549.7373 A5,5 0 0 1 1735,1554.7373 L1176,1554.7373 A5,5 0 0 1 1171,1549.7373 L1171,63.7373 A5,5 0 0 1 1176,58.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="1171" x2="1405" y1="81.752" y2="81.752"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="221" x="1175" y="74.8125">Agent Graph Execution Flow</text></g><!--cluster Tool Resolution & Placeholders--><g id="cluster_Tool Resolution &amp; Placeholders"><path d="M2216,1125.2373 L2453,1125.2373 A7.5,7.5 0 0 1 2458,1130.2373 L2465,1148.252 L2647,1148.252 A5,5 0 0 1 2652,1153.252 L2652,1988.2373 A5,5 0 0 1 2647,1993.2373 L2216,1993.2373 A5,5 0 0 1 2211,1988.2373 L2211,1130.2373 A5,5 0 0 1 2216,1125.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="2211" x2="2465" y1="1148.252" y2="1148.252"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="241" x="2215" y="1141.3125">Tool Resolution &amp; Placeholders</text></g><!--cluster PlaceholderRes--><g id="cluster_PlaceholderRes"><rect fill="#FFFFFF" height="252" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="377" x="2243" y="1393.7373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="177" x="2343" y="1409.8125">Placeholder Resolution</text></g><!--cluster SmartDefaults--><g id="cluster_SmartDefaults"><rect fill="#FFFFFF" height="204" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="335" x="2253" y="1757.2373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="114" x="2363.5" y="1773.3125">Smart Defaults</text></g><!--cluster Response Processing--><g id="cluster_Response Processing"><path d="M2681,990.2373 L2841,990.2373 A7.5,7.5 0 0 1 2846,995.2373 L2853,1013.252 L3142,1013.252 A5,5 0 0 1 3147,1018.252 L3147,1625.2373 A5,5 0 0 1 3142,1630.2373 L2681,1630.2373 A5,5 0 0 1 2676,1625.2373 L2676,995.2373 A5,5 0 0 1 2681,990.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="2676" x2="2853" y1="1013.252" y2="1013.252"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="164" x="2680" y="1006.3125">Response Processing</text></g><!--cluster FinalResponse--><g id="cluster_FinalResponse"><rect fill="#FFFFFF" height="236" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="259" x="2708" y="1042.2373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="116" x="2779.5" y="1058.3125">Final Response</text></g><!--cluster HistoryMgmt--><g id="cluster_HistoryMgmt"><rect fill="#FFFFFF" height="157" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="407" x="2708" y="1441.2373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="159" x="2832" y="1457.3125">History Management</text></g><!--cluster Tool Integration--><g id="cluster_Tool Integration"><path d="M727,1357.7373 L851,1357.7373 A7.5,7.5 0 0 1 856,1362.7373 L863,1380.752 L1142,1380.752 A5,5 0 0 1 1147,1385.752 L1147,1964.7373 A5,5 0 0 1 1142,1969.7373 L727,1969.7373 A5,5 0 0 1 722,1964.7373 L722,1362.7373 A5,5 0 0 1 727,1357.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="722" x2="863" y1="1380.752" y2="1380.752"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="128" x="726" y="1373.8125">Tool Integration</text></g><!--cluster PlannerAdapter--><g id="cluster_PlannerAdapter"><rect fill="#FFFFFF" height="220" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="251" x="809" y="1409.7373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="150" x="859.5" y="1425.8125">PlannerAPIAdapter</text></g><!--cluster ToolWrappers--><g id="cluster_ToolWrappers"><rect fill="#FFFFFF" height="157" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="361" x="754" y="1780.7373"/><text fill="#000000" font-family="Verdana" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="115" x="877" y="1796.8125">Tool Wrappers</text></g><!--entity PlannerBot--><g id="elem_PlannerBot"><rect fill="#FFFFFF" height="54.0293" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="139" x="261.5" y="850.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="76" x="271.5" y="874.8125">PlannerBot</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="119" x="271.5" y="891.8271">(planner_bot.py)</text></g><g id="elem_GMN4"><path d="M435.5,846.2373 L435.5,909.4346 A5,5 0 0 0 440.5,914.4346 L641.5,914.4346 A5,5 0 0 0 646.5,909.4346 L646.5,851.2373 L636.5,841.2373 L440.5,841.2373 A5,5 0 0 0 435.5,846.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M636.5,841.2373 L636.5,848.7373 A2.5,2.5 0 0 0 639,851.2373 L646.5,851.2373 L636.5,841.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="85" x="441.5" y="859.3071">Initialization:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="154" x="441.5" y="875.1064">- Creates LLMHandler()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="190" x="441.5" y="890.9058">- Creates PlannerAPIAdapter</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="132" x="441.5" y="906.7051">- Registers handlers</text></g><g id="elem_GMN8"><path d="M320.5,1043.7373 L320.5,1296.5264 A5,5 0 0 0 325.5,1301.5264 L636.5,1301.5264 A5,5 0 0 0 641.5,1296.5264 L641.5,1048.7373 L631.5,1038.7373 L325.5,1038.7373 A5,5 0 0 0 320.5,1043.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M631.5,1038.7373 L631.5,1046.2373 A2.5,2.5 0 0 0 634,1048.7373 L641.5,1048.7373 L631.5,1038.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="93" x="326.5" y="1056.8071">Configuration:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="289" x="326.5" y="1072.6064">- chat_model: ChatVertexAI or ChatOpenAI</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="218" x="326.5" y="1088.4058">- max_iterations: int (default: 6)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="295" x="326.5" y="1104.2051">- chat_history: Dict[str, List[BaseMessage]]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="231" x="326.5" y="1120.0044">- plan_adapter: PlannerAPIAdapter</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="189" x="326.5" y="1135.8037">- tools: List[StructuredTool]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="300" x="326.5" y="1151.603">- conversation_repo: ConversationRepository</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="326.5" y="1167.4023">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113" x="326.5" y="1183.2017">System Prompts:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="230" x="326.5" y="1199.001">- system_message_main_base: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="268" x="326.5" y="1214.8003">- system_message_api: SystemMessage</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="263" x="326.5" y="1230.5996">- system_message_planner_prompt: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="326.5" y="1246.3989">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="75" x="326.5" y="1262.1982">Agent App:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="189" x="326.5" y="1277.9976">- agent_app: CompiledGraph</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="289" x="326.5" y="1293.7969">- Created via create_plan_execute_graph()</text></g><g id="elem_GMN12"><path d="M333,1458.7373 L333,1600.9312 A5,5 0 0 0 338,1605.9312 L624,1605.9312 A5,5 0 0 0 629,1600.9312 L629,1463.7373 L619,1453.7373 L338,1453.7373 A5,5 0 0 0 333,1458.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M619,1453.7373 L619,1461.2373 A2.5,2.5 0 0 0 621.5,1463.7373 L629,1463.7373 L619,1453.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="89" x="339" y="1471.8071">Graph Nodes:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251" x="339" y="1487.6064">+ planner: AgentState -&gt; AgentState</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="261" x="339" y="1503.4058">+ executor: AgentState -&gt; AgentState</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="275" x="339" y="1519.2051">+ tools_node: AgentState -&gt; AgentState</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="339" y="1535.0044">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="132" x="339" y="1550.8037">State Management:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="213" x="339" y="1566.603">+ should_continue: routing logic</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="242" x="339" y="1582.4023">+ _validate_and_repair_plan_steps()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="105" x="339" y="1598.2017">+ _parse_plan()</text></g><g id="elem_GMN19"><path d="M1855.5,1490.2373 L1855.5,1569.2339 A5,5 0 0 0 1860.5,1574.2339 L2125.5,1574.2339 A5,5 0 0 0 2130.5,1569.2339 L2130.5,1495.2373 L2120.5,1485.2373 L1860.5,1485.2373 A5,5 0 0 0 1855.5,1490.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M2120.5,1485.2373 L2120.5,1492.7373 A2.5,2.5 0 0 0 2123,1495.2373 L2130.5,1495.2373 L2120.5,1485.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="79" x="1861.5" y="1503.3071">Entry Point:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155" x="1861.5" y="1519.1064">handle_text_message()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="161" x="1861.5" y="1534.9058">- Receives UserMessage</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142" x="1861.5" y="1550.7051">- Gets user_language</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="254" x="1861.5" y="1566.5044">- Calls LLMHandler.get_response_api()</text></g><g id="elem_GMN23"><path d="M1849,1742.7373 L1849,1995.5264 A5,5 0 0 0 1854,2000.5264 L2126,2000.5264 A5,5 0 0 0 2131,1995.5264 L2131,1747.7373 L2121,1737.7373 L1854,1737.7373 A5,5 0 0 0 1849,1742.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M2121,1737.7373 L2121,1745.2373 A2.5,2.5 0 0 0 2123.5,1747.7373 L2131,1747.7373 L2121,1737.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120" x="1855" y="1755.8071">Input Parameters:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="136" x="1855" y="1771.6064">+ user_message: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="90" x="1855" y="1787.4058">+ user_id: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="207" x="1855" y="1803.2051">+ user_language: str (optional)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="261" x="1855" y="1819.0044">+ progress_callback: Callable (optional)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1855" y="1834.8037">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112" x="1855" y="1850.603">Context Building:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="137" x="1855" y="1866.4023">+ Builds message list</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="158" x="1855" y="1882.2017">+ Gets system message</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="137" x="1855" y="1898.001">+ Loads chat history</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="189" x="1855" y="1913.8003">+ Sets up LangSmith tracing</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1855" y="1929.5996">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120" x="1855" y="1945.3989">Agent Invocation:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="146" x="1855" y="1961.1982">+ Creates AgentState</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="234" x="1855" y="1976.9976">+ Invokes agent_app.invoke(state)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="165" x="1855" y="1992.7969">+ Processes result_state</text></g><g id="elem_GMN29"><path d="M1834.5,2181.7373 L1834.5,2576.7202 A5,5 0 0 0 1839.5,2581.7202 L2170.5,2581.7202 A5,5 0 0 0 2175.5,2576.7202 L2175.5,2186.7373 L2165.5,2176.7373 L1839.5,2176.7373 A5,5 0 0 0 1834.5,2181.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M2165.5,2176.7373 L2165.5,2184.2373 A2.5,2.5 0 0 0 2168,2186.7373 L2175.5,2186.7373 L2165.5,2176.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="260" x="1840.5" y="2194.8071">Built by _get_system_message_main():</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1840.5" y="2210.6064">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="149" x="1840.5" y="2226.4058">ROLE &amp; PERSONALITY:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="171" x="1840.5" y="2242.2051">- Base personality prompt</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="226" x="1840.5" y="2258.0044">- Task management assistant role</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1840.5" y="2273.8037">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="93" x="1840.5" y="2289.603">DATE &amp; TIME:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="320" x="1840.5" y="2305.4023">- current_date_str: "Monday, January 15, 2025"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="181" x="1840.5" y="2321.2017">- current_time_str: "14:30"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1840.5" y="2337.001">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="77" x="1840.5" y="2352.8003">USER INFO:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="88" x="1840.5" y="2368.5996">- user_id: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="214" x="1840.5" y="2384.3989">- first_name: str (from settings)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1840.5" y="2400.1982">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="197" x="1840.5" y="2415.9976">USER PROMISES (in context):</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="297" x="1840.5" y="2431.7969">- promise_list: "P10: Do sport, P01: Reading"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="205" x="1840.5" y="2447.5962">- promise_count: int (if &lt;= 50)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1840.5" y="2463.3955">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166" x="1840.5" y="2479.1948">RECENT CONVERSATION:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="192" x="1840.5" y="2494.9941">- conversation_summary: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="182" x="1840.5" y="2510.7935">- Last 3 conversation turns</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1840.5" y="2526.5928">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="172" x="1840.5" y="2542.3921">LANGUAGE MANAGEMENT:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="233" x="1840.5" y="2558.1914">- user_language: "en" or "fr" or "fa"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="157" x="1840.5" y="2573.9907">- Language instructions</text></g><g id="elem_GMN33"><path d="M1847,2754.2373 L1847,2849.0332 A5,5 0 0 0 1852,2854.0332 L2158,2854.0332 A5,5 0 0 0 2163,2849.0332 L2163,2759.2373 L2153,2749.2373 L1852,2749.2373 A5,5 0 0 0 1847,2754.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M2153,2749.2373 L2153,2756.7373 A2.5,2.5 0 0 0 2155.5,2759.2373 L2163,2759.2373 L2153,2749.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166" x="1853" y="2767.3071">Messages sent to agent:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1853" y="2783.1064">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="227" x="1853" y="2798.9058">1. SystemMessage (main context)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="200" x="1853" y="2814.7051">2. SystemMessage (API tools)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="295" x="1853" y="2830.5044">3. prior_history (HumanMessage/AIMessage)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="282" x="1853" y="2846.3037">4. HumanMessage (current user_message)</text></g><g id="elem_GMN40"><path d="M2296,2722.7373 L2296,2880.7305 A5,5 0 0 0 2301,2885.7305 L2635,2885.7305 A5,5 0 0 0 2640,2880.7305 L2640,2727.7373 L2630,2717.7373 L2301,2717.7373 A5,5 0 0 0 2296,2722.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M2630,2717.7373 L2630,2725.2373 A2.5,2.5 0 0 0 2632.5,2727.7373 L2640,2727.7373 L2630,2717.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="107" x="2302" y="2735.8071">State Variables:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="212" x="2302" y="2751.6064">+ messages: List[BaseMessage]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="97" x="2302" y="2767.4058">+ iteration: int</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="178" x="2302" y="2783.2051">+ plan: Optional[List[dict]]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="97" x="2302" y="2799.0044">+ step_idx: int</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="203" x="2302" y="2814.8037">+ final_response: Optional[str]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196" x="2302" y="2830.603">+ planner_error: Optional[str]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="323" x="2302" y="2846.4023">+ pending_meta_by_idx: Optional[Dict[int, dict]]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251" x="2302" y="2862.2017">+ pending_clarification: Optional[dict]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="292" x="2302" y="2878.001">+ tool_retry_counts: Optional[Dict[str, int]]</text></g><!--entity PlannerNode--><g id="elem_PlannerNode"><rect fill="#FFFFFF" height="37.0146" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="112" x="1193" y="261.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="92" x="1203" y="285.8125">Planner Node</text></g><g id="elem_GMN45"><path d="M1340,177.7373 L1340,276.7373 L1305.14,280.7373 L1340,284.7373 L1340,383.1284 A5,5 0 0 0 1345,388.1284 L1589,388.1284 A5,5 0 0 0 1594,383.1284 L1594,182.7373 L1584,172.7373 L1345,172.7373 A5,5 0 0 0 1340,177.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M1584,172.7373 L1584,180.2373 A2.5,2.5 0 0 0 1586.5,182.7373 L1594,182.7373 L1584,172.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="41" x="1346" y="190.8071">Input:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="212" x="1346" y="206.6064">+ messages: List[BaseMessage]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="233" x="1346" y="222.4058">+ planner_prompt: SystemMessage</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1346" y="238.2051">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="76" x="1346" y="254.0044">Processing:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="227" x="1346" y="269.8037">+ Invoke planner_model (no tools)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="121" x="1346" y="285.603">+ Parse JSON plan</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="164" x="1346" y="301.4023">+ Validate &amp; repair steps</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1346" y="317.2017">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="1346" y="333.001">Output:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="145" x="1346" y="348.8003">+ plan: List[PlanStep]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193" x="1346" y="364.5996">+ pending_meta_by_idx: Dict</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="217" x="1346" y="380.3989">+ final_response_if_no_tools: str</text></g><!--entity ExecutorNode--><g id="elem_ExecutorNode"><rect fill="#FFFFFF" height="37.0146" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="124" x="1187" y="576.2373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="104" x="1197" y="600.3125">Executor Node</text></g><g id="elem_GMN49"><path d="M1346.5,452.7373 L1346.5,590.7373 L1311.06,594.7373 L1346.5,598.7373 L1346.5,737.125 A5,5 0 0 0 1351.5,742.125 L1718.5,742.125 A5,5 0 0 0 1723.5,737.125 L1723.5,457.7373 L1713.5,447.7373 L1351.5,447.7373 A5,5 0 0 0 1346.5,452.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M1713.5,447.7373 L1713.5,455.2373 A2.5,2.5 0 0 0 1716,457.7373 L1723.5,457.7373 L1713.5,447.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112" x="1352.5" y="465.8071">Step Processing:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="257" x="1352.5" y="481.6064">+ Get current step from plan[step_idx]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="341" x="1352.5" y="497.4058">+ Check step.kind: "tool" or "respond" or "ask_user"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1352.5" y="513.2051">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="70" x="1352.5" y="529.0044">Tool Step:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="356" x="1352.5" y="544.8037">+ Resolve placeholders (FROM_SEARCH, FROM_TOOL)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="234" x="1352.5" y="560.603">+ Create AIMessage with tool_calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="131" x="1352.5" y="576.4023">+ Advance step_idx</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1352.5" y="592.2017">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="97" x="1352.5" y="608.001">Respond Step:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="174" x="1352.5" y="623.8003">+ Invoke responder_model</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173" x="1352.5" y="639.5996">+ Generate final_response</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="131" x="1352.5" y="655.3989">+ Advance step_idx</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1352.5" y="671.1982">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="99" x="1352.5" y="686.9976">Ask User Step:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="211" x="1352.5" y="702.7969">+ Set final_response = question</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="177" x="1352.5" y="718.5962">+ Set pending_clarification</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="131" x="1352.5" y="734.3955">+ Advance step_idx</text></g><!--entity ToolsNode--><g id="elem_ToolsNode"><rect fill="#FFFFFF" height="37.0146" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="99" x="1193.5" y="859.2373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="79" x="1203.5" y="883.3125">Tools Node</text></g><g id="elem_GMN53"><path d="M1327.5,806.7373 L1327.5,867.7373 L1292.58,871.7373 L1327.5,875.7373 L1327.5,948.9312 A5,5 0 0 0 1332.5,953.9312 L1567.5,953.9312 A5,5 0 0 0 1572.5,948.9312 L1572.5,811.7373 L1562.5,801.7373 L1332.5,801.7373 A5,5 0 0 0 1327.5,806.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M1562.5,801.7373 L1562.5,809.2373 A2.5,2.5 0 0 0 1565,811.7373 L1572.5,811.7373 L1562.5,801.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="103" x="1333.5" y="819.8071">Tool Execution:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="184" x="1333.5" y="835.6064">+ Execute tool.invoke(args)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="224" x="1333.5" y="851.4058">+ Handle retries (transient errors)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="223" x="1333.5" y="867.2051">+ Create ToolMessage with result</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="1333.5" y="883.0044">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="97" x="1333.5" y="898.8037">Error Handling:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="129" x="1333.5" y="914.603">+ Catch exceptions</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="184" x="1333.5" y="930.4023">+ Create error ToolMessage</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="186" x="1333.5" y="946.2017">+ Mark retryable if transient</text></g><!--entity Routing--><g id="elem_Routing"><rect fill="#FFFFFF" height="37.0146" rx="5" ry="5" style="stroke:#000000;stroke-width:1.0;" width="116" x="1307" y="1151.7373"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="96" x="1317" y="1175.8125">Routing Logic</text></g><g id="elem_GMN57"><path d="M1458,1130.7373 L1458,1166.7373 L1423.2,1170.7373 L1458,1174.7373 L1458,1209.7339 A5,5 0 0 0 1463,1214.7339 L1719,1214.7339 A5,5 0 0 0 1724,1209.7339 L1724,1135.7373 L1714,1125.7373 L1463,1125.7373 A5,5 0 0 0 1458,1130.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M1714,1125.7373 L1714,1133.2373 A2.5,2.5 0 0 0 1716.5,1135.7373 L1724,1135.7373 L1714,1125.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="125" x="1464" y="1143.8071">should_continue():</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196" x="1464" y="1159.6064">+ Check final_response exists</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="229" x="1464" y="1175.4058">+ Check iteration &lt; max_iterations</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="152" x="1464" y="1191.2051">+ Check has_tool_calls</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245" x="1464" y="1207.0044">+ Route: "tools" or "executor" or END</text></g><!--entity AgentInvoke--><g id="elem_AgentInvoke"><ellipse cx="1249" cy="103.7373" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="89" x="1204.5" y="134.8125">AgentInvoke</text></g><!--entity END--><g id="elem_END"><ellipse cx="1535" cy="1529.7373" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="30" x="1520" y="1560.8125">END</text></g><!--entity ToolStep--><g id="elem_ToolStep"><ellipse cx="2439" cy="1170.2373" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="63" x="2407.5" y="1201.3125">ToolStep</text></g><g id="elem_GMN70"><path d="M2286.5,1442.7373 L2286.5,1616.5298 A5,5 0 0 0 2291.5,1621.5298 L2590.5,1621.5298 A5,5 0 0 0 2595.5,1616.5298 L2595.5,1447.7373 L2585.5,1437.7373 L2291.5,1437.7373 A5,5 0 0 0 2286.5,1442.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M2585.5,1437.7373 L2585.5,1445.2373 A2.5,2.5 0 0 0 2588,1447.7373 L2595.5,1447.7373 L2585.5,1437.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="161" x="2292.5" y="1455.8071">Supported Placeholders:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="2292.5" y="1471.6064">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="103" x="2292.5" y="1487.4058">FROM_SEARCH:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="288" x="2292.5" y="1503.2051">- Resolves from last search_promises result</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="212" x="2292.5" y="1519.0044">- Checks for single_match JSON</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141" x="2292.5" y="1534.8037">- Extracts promise_id</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="2292.5" y="1550.603">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="194" x="2292.5" y="1566.4023">FROM_TOOL:tool_name:field:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="211" x="2292.5" y="1582.2017">- Resolves from last tool output</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="218" x="2292.5" y="1598.001">- Parses JSON from ToolMessage</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="139" x="2292.5" y="1613.8003">- Extracts field value</text></g><g id="elem_GMN74"><path d="M2296.5,1806.2373 L2296.5,1932.6318 A5,5 0 0 0 2301.5,1937.6318 L2558.5,1937.6318 A5,5 0 0 0 2563.5,1932.6318 L2563.5,1811.2373 L2553.5,1801.2373 L2301.5,1801.2373 A5,5 0 0 0 2296.5,1806.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M2553.5,1801.2373 L2553.5,1808.7373 A2.5,2.5 0 0 0 2556,1811.2373 L2563.5,1811.2373 L2553.5,1801.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="133" x="2302.5" y="1819.3071">Inferred Arguments:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="2302.5" y="1835.1064">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="168" x="2302.5" y="1850.9058">time_spent: 1.0 (default)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="151" x="2302.5" y="1866.7051">- Applied when missing</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="2302.5" y="1882.5044">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="177" x="2302.5" y="1898.3037">promise_id: FROM_SEARCH</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="212" x="2302.5" y="1914.103">- Auto-filled from search results</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="246" x="2302.5" y="1929.9023">- Falls back to ask_user if ambiguous</text></g><g id="elem_GMN82"><path d="M2751,1091.2373 L2751,1249.2305 A5,5 0 0 0 2756,1254.2305 L2938,1254.2305 A5,5 0 0 0 2943,1249.2305 L2943,1096.2373 L2933,1086.2373 L2756,1086.2373 A5,5 0 0 0 2751,1091.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M2933,1086.2373 L2933,1093.7373 A2.5,2.5 0 0 0 2935.5,1096.2373 L2943,1096.2373 L2933,1086.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120" x="2757" y="1104.3071">Return Dictionary:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="2757" y="1120.1064">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="113" x="2757" y="1135.9058">function_call: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="126" x="2757" y="1151.7051">function_args: dict</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="146" x="2757" y="1167.5044">response_to_user: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169" x="2757" y="1183.3037">executed_by_agent: bool</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="96" x="2757" y="1199.103">tool_calls: List</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148" x="2757" y="1214.9023">tool_outputs: List[str]</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110" x="2757" y="1230.7017">stop_reason: str</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="171" x="2757" y="1246.501">pending_clarification: dict</text></g><g id="elem_GMN86"><path d="M2751.5,1490.2373 L2751.5,1569.2339 A5,5 0 0 0 2756.5,1574.2339 L3085.5,1574.2339 A5,5 0 0 0 3090.5,1569.2339 L3090.5,1495.2373 L3080.5,1485.2373 L2756.5,1485.2373 A5,5 0 0 0 2751.5,1490.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M3080.5,1485.2373 L3080.5,1492.7373 A2.5,2.5 0 0 0 3083,1495.2373 L3090.5,1495.2373 L3080.5,1485.2373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="88" x="2757.5" y="1503.3071">Chat History:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="2757.5" y="1519.1064">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="318" x="2757.5" y="1534.9058">- Condensed to HumanMessage/AIMessage only</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="140" x="2757.5" y="1550.7051">- Keeps last 12 turns</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="134" x="2757.5" y="1566.5044">- Stored per user_id</text></g><g id="elem_GMN94"><path d="M852.5,1458.7373 L852.5,1600.9312 A5,5 0 0 0 857.5,1605.9312 L1030.5,1605.9312 A5,5 0 0 0 1035.5,1600.9312 L1035.5,1463.7373 L1025.5,1453.7373 L857.5,1453.7373 A5,5 0 0 0 852.5,1458.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M1025.5,1453.7373 L1025.5,1461.2373 A2.5,2.5 0 0 0 1028,1463.7373 L1035.5,1463.7373 L1025.5,1453.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104" x="858.5" y="1471.8071">Available Tools:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="858.5" y="1487.6064">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="106" x="858.5" y="1503.4058">- add_promise()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="133" x="858.5" y="1519.2051">- search_promises()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="97" x="858.5" y="1535.0044">- add_action()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="111" x="858.5" y="1550.8037">- get_promises()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="147" x="858.5" y="1566.603">- get_weekly_report()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="124" x="858.5" y="1582.4023">- update_setting()</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="162" x="858.5" y="1598.2017">- ... (all public methods)</text></g><g id="elem_GMN98"><path d="M797.5,1829.7373 L797.5,1908.7339 A5,5 0 0 0 802.5,1913.7339 L1085.5,1913.7339 A5,5 0 0 0 1090.5,1908.7339 L1090.5,1834.7373 L1080.5,1824.7373 L802.5,1824.7373 A5,5 0 0 0 797.5,1829.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M1080.5,1824.7373 L1080.5,1832.2373 A2.5,2.5 0 0 0 1083,1834.7373 L1090.5,1834.7373 L1080.5,1824.7373 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="100" x="803.5" y="1842.8071">Tool Wrapping:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="5" x="803.5" y="1858.6064">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="248" x="803.5" y="1874.4058">- _wrap_tool(): Adds user_id context</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="272" x="803.5" y="1890.2051">- _current_user_id: Thread-local storage</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="192" x="803.5" y="1906.0044">- _sanitize_user_id(): Safety</text></g><!--link PlannerBot to GMN4--><g id="link_PlannerBot_GMN4"><path d="M400.64,877.7373 C411.74,877.7373 423.44,877.7373 435.15,877.7373 " fill="none" id="PlannerBot-GMN4" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link GMN4 to GMN8--><g id="link_GMN4_GMN8"><path d="M538.5,914.4873 C538.5,945.9373 538.5,993.2073 538.5,1038.5773 " fill="none" id="GMN4-GMN8" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link GMN8 to GMN12--><g id="link_GMN8_GMN12"><path d="M530.33,1301.8073 C530.33,1352.8273 530.33,1409.4473 530.33,1453.4873 " fill="none" id="GMN8-GMN12" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link PlannerBot to LLMHandler--><g id="link_PlannerBot_LLMHandler"><path d="M285,904.9973 C285,922.5823 285,947.2073 285,974.4309 C285,975.2816 285,970.1349 285,970.9906 " fill="none" id="PlannerBot-to-LLMHandler" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="285,976.9906,289,967.9906,285,971.9906,281,967.9906,285,976.9906" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="72" x="212" y="1034.4071">1. Initialize</text></g><!--link LLMHandler to AgentGraph--><g id="link_LLMHandler_AgentGraph"><path d="M285,1327.5574 C285,1328.9193 285,1330.2829 285,1331.648 C285,1334.378 285,1337.1138 285,1339.8527 C285,1345.3306 285,1350.821 285,1356.3036 C285,1444.0248 285,1529.7373 285,1529.7373 C285,1529.7373 285.6219,1529.7373 286.5936,1529.7373 C287.0795,1529.7373 287.6528,1529.7373 288.2796,1529.7373 C288.5929,1529.7373 288.9197,1529.7373 289.2556,1529.7373 C289.4235,1529.7373 289.5937,1529.7373 289.7657,1529.7373 C289.8087,1529.7373 289.8518,1529.7373 289.895,1529.7373 C289.9166,1529.7373 283.9382,1529.7373 283.9598,1529.7373 " fill="none" id="LLMHandler-to-AgentGraph" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="289.9598,1529.7373,280.9598,1525.7373,284.9598,1529.7373,280.9598,1533.7373,289.9598,1529.7373" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="208" x="44" y="1305.5671">2. create_plan_execute_graph(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="262" x="22" y="1321.3664">tools, planner_model, responder_model,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="208" x="49" y="1337.1658">planner_prompt, max_iterations</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="6" x="145" y="1352.9651">)</text></g><!--link LLMHandler to AgentGraph--><g id="link_LLMHandler_AgentGraph"><path d="M298,1327.5477 C298,1332.9865 298,1338.4536 298,1343.9286 C298,1354.8784 298,1365.8596 298,1376.7089 C298,1379.4212 298,1382.1253 298,1384.8186 C298,1386.1652 298,1387.5091 298,1388.8501 C298,1389.5205 298,1390.1902 298,1390.8591 C298,1391.1936 298,1385.5279 298,1385.8619 " fill="none" id="LLMHandler-to-AgentGraph-1" style="stroke:#0000FF;stroke-width:1.0;"/><polygon fill="#0000FF" points="298,1391.8619,302,1382.8619,298,1386.8619,294,1382.8619,298,1391.8619" style="stroke:#0000FF;stroke-width:1.0;"/></g><!--link GMN12 to GMN19--><g id="link_GMN12_GMN19"><path d="M431.67,1453.4873 C431.67,1448.6873 431.67,1445.7373 431.67,1445.7373 C431.67,1445.7373 1993,1445.7373 1993,1445.7373 C1993,1445.7373 1993,1464.8173 1993,1484.7873 " fill="none" id="GMN12-GMN19" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link GMN19 to GMN23--><g id="link_GMN19_GMN23"><path d="M1993,1574.4673 C1993,1615.9773 1993,1679.8473 1993,1737.5473 " fill="none" id="GMN19-GMN23" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link MessageHandler to GetResponseAPI--><g id="link_MessageHandler_GetResponseAPI"><path d="M1820,1599.1298 C1820,1600.1991 1820,1601.2766 1820,1602.3621 C1820,1606.7041 1820,1611.1741 1820,1615.7525 C1820,1624.9094 1820,1634.5005 1820,1644.3711 C1820,1654.2417 1820,1664.3918 1820,1674.6669 C1820,1679.8045 1820,1684.9732 1820,1690.1539 C1820,1690.8015 1820,1691.4493 1820,1692.0972 C1820,1692.4211 1820,1692.7451 1820,1693.0692 C1820,1693.2312 1820,1687.3932 1820,1687.5552 " fill="none" id="MessageHandler-to-GetResponseAPI" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1820,1693.5552,1824,1684.5552,1820,1688.5552,1816,1684.5552,1820,1693.5552" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122" x="1697" y="1637.0471">get_response_api(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="98" x="1714" y="1652.8464">user_message,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="1737" y="1668.6458">user_id,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="95" x="1715.5" y="1684.4451">user_language</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="6" x="1755" y="1700.2444">)</text></g><!--link GMN23 to GMN29--><g id="link_GMN23_GMN29"><path d="M1990,2000.9073 C1990,2054.3273 1990,2117.2573 1990,2176.2973 " fill="none" id="GMN23-GMN29" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link GMN29 to GMN33--><g id="link_GMN29_GMN33"><path d="M2005,2581.8273 C2005,2643.6673 2005,2706.4973 2005,2749.0773 " fill="none" id="GMN29-GMN33" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link GetResponseAPI to SystemMsg--><g id="link_GetResponseAPI_SystemMsg"><path d="M1805.9605,1869.7373 C1805.9057,1869.7373 1805.851,1869.7373 1805.7963,1869.7373 C1802.295,1869.7373 1799,1869.7373 1799,1869.7373 C1799,1869.7373 1799,1993.1623 1799,2118.5161 C1799,2122.4334 1799,2120.3525 1799,2124.2699 " fill="none" id="GetResponseAPI-to-SystemMsg" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1799,2130.2699,1803,2121.2699,1799,2125.2699,1795,2121.2699,1799,2130.2699" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="200" x="1598" y="2113.9571">_get_system_message_main()</text></g><!--link SystemMsg to MsgList--><g id="link_SystemMsg_MsgList"><path d="M1812,2607.4513 C1812,2609.0566 1812,2610.6606 1812,2612.263 C1812,2615.4676 1812,2618.6656 1812,2621.8539 C1812,2634.6072 1812,2647.2053 1812,2659.4565 C1812,2671.7078 1812,2683.612 1812,2694.9775 C1812,2697.8188 1812,2700.6265 1812,2703.3975 C1812,2703.7439 1812,2704.0897 1812,2704.4349 C1812,2704.6075 1812,2704.78 1812,2704.9523 C1812,2705.0385 1812,2699.1246 1812,2699.2107 " fill="none" id="SystemMsg-to-MsgList" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1812,2705.2107,1816,2696.2107,1812,2700.2107,1808,2696.2107,1812,2705.2107" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="116" x="1695" y="2581.0371">Build message list</text></g><!--link GMN33 to GMN40--><g id="link_GMN33_GMN40"><path d="M2163.04,2801.7373 C2205.74,2801.7373 2252.16,2801.7373 2295.61,2801.7373 " fill="none" id="GMN33-GMN40" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link AgentInvoke to PlannerNode--><g id="link_AgentInvoke_PlannerNode"><path d="M1246,113.2273 C1246,141.2973 1246,218.2873 1246,255.6373 " fill="none" id="AgentInvoke-to-PlannerNode" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1246,261.6373,1250,252.6373,1246,256.6373,1242,252.6373,1246,261.6373" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="76" x="1169" y="184.5071">Initial state</text></g><!--link AgentInvoke to PlannerNode--><g id="link_AgentInvoke_PlannerNode"><path d="M1252,113.2273 C1252,141.2973 1252,218.2873 1252,255.6373 " fill="none" id="AgentInvoke-to-PlannerNode-1" style="stroke:#800080;stroke-width:1.0;"/><polygon fill="#800080" points="1252,261.6373,1256,252.6373,1252,256.6373,1248,252.6373,1252,261.6373" style="stroke:#800080;stroke-width:1.0;"/></g><!--link PlannerNode to ExecutorNode--><g id="link_PlannerNode_ExecutorNode"><path d="M1267.67,298.9673 C1267.67,354.9073 1267.67,514.2973 1267.67,570.1073 " fill="none" id="PlannerNode-to-ExecutorNode" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1267.67,576.1073,1271.67,567.1073,1267.67,571.1073,1263.67,567.1073,1267.67,576.1073" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="83" x="1183.67" y="434.6071">plan created</text></g><!--link PlannerNode to ExecutorNode--><g id="link_PlannerNode_ExecutorNode"><path d="M1230.33,298.9673 C1230.33,354.9073 1230.33,514.2973 1230.33,570.1073 " fill="none" id="PlannerNode-to-ExecutorNode-1" style="stroke:#FFA500;stroke-width:1.0;"/><polygon fill="#FFA500" points="1230.33,576.1073,1234.33,567.1073,1230.33,571.1073,1226.33,567.1073,1230.33,576.1073" style="stroke:#FFA500;stroke-width:1.0;"/></g><!--link ExecutorNode to ToolsNode--><g id="link_ExecutorNode_ToolsNode"><path d="M1259.5,613.3073 C1259.5,664.5873 1259.5,801.7373 1259.5,853.0973 " fill="none" id="ExecutorNode-to-ToolsNode" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1259.5,859.0973,1263.5,850.0973,1259.5,854.0973,1255.5,850.0973,1259.5,859.0973" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="90" x="1168.5" y="733.2771">has tool_calls</text></g><!--link ExecutorNode to ToolsNode--><g id="link_ExecutorNode_ToolsNode"><path d="M1226.5,613.3073 C1226.5,664.5873 1226.5,801.7373 1226.5,853.0973 " fill="none" id="ExecutorNode-to-ToolsNode-1" style="stroke:#FF0000;stroke-width:1.0;"/><polygon fill="#FF0000" points="1226.5,859.0973,1230.5,850.0973,1226.5,854.0973,1222.5,850.0973,1226.5,859.0973" style="stroke:#FF0000;stroke-width:1.0;"/></g><!--link ToolsNode to Routing--><g id="link_ToolsNode_Routing"><path d="M1292.58,884.7373 C1307.15,884.7373 1319.25,884.7373 1319.25,884.7373 C1319.25,884.7373 1319.25,1081.9873 1319.25,1145.5073 " fill="none" id="ToolsNode-to-Routing" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1319.25,1151.5073,1323.25,1142.5073,1319.25,1146.5073,1315.25,1142.5073,1319.25,1151.5073" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91" x="1227.25" y="1001.8571">tool executed</text></g><!--link Routing to ExecutorNode--><g id="link_Routing_ExecutorNode"><path d="M1306.98,1170.7373 C1302.55,1170.7373 1299.75,1170.7373 1299.75,1170.7373 C1299.75,1170.7373 1299.75,717.8373 1299.75,619.2473 " fill="none" id="Routing-to-ExecutorNode" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1299.75,613.2473,1295.75,622.2473,1299.75,618.2473,1303.75,622.2473,1299.75,613.2473" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="57" x="1256.5" y="909.6771">continue</text></g><!--link Routing to END--><g id="link_Routing_END"><path d="M1365,1188.8073 C1365,1262.4273 1365,1529.7373 1365,1529.7373 C1365,1529.7373 1484.55,1529.7373 1519.86,1529.7373 " fill="none" id="Routing-to-END" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1525.86,1529.7373,1516.86,1525.7373,1520.86,1529.7373,1516.86,1533.7373,1525.86,1529.7373" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="32" x="1332" y="1436.7771">done</text></g><!--link END to GMN70--><g id="link_END_GMN70"><path d="M1535,1520.6273 C1535,1503.8373 1535,1469.7373 1535,1469.7373 C1535,1469.7373 2027.52,1469.7373 2286.28,1469.7373 " fill="none" id="END-GMN70" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link GMN70 to GMN74--><g id="link_GMN70_GMN74"><path d="M2430,1622.0573 C2430,1678.6073 2430,1749.7473 2430,1801.1673 " fill="none" id="GMN70-GMN74" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link ToolStep to PlaceholderRes--><g id="link_ToolStep_PlaceholderRes"><path d="M2429.93,1170.7373 C2392.38,1170.7373 2251,1170.7373 2251,1170.7373 C2251,1170.7373 2251,1256.3298 2251,1343.9286 C2251,1354.8784 2251,1365.8596 2251,1376.7089 C2251,1382.1335 2251,1381.5252 2251,1386.8635 " fill="none" id="ToolStep-to-PlaceholderRes" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="2251,1392.8635,2255,1383.8635,2251,1387.8635,2247,1383.8635,2251,1392.8635" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="137" x="2113" y="1257.5471">Resolve placeholders</text></g><!--link PlaceholderRes to SmartDefaults--><g id="link_PlaceholderRes_SmartDefaults"><path d="M2261,1645.7868 C2261,1646.4047 2261,1647.0236 2261,1647.6435 C2261,1652.6028 2261,1657.6275 2261,1662.6981 C2261,1672.8395 2261,1683.1648 2261,1693.5198 C2261,1714.2298 2261,1735.0584 2261,1754.7705 C2261,1755.3865 2261,1750.0014 2261,1750.6152 " fill="none" id="PlaceholderRes-to-SmartDefaults" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="2261,1756.6152,2265,1747.6152,2261,1751.6152,2257,1747.6152,2261,1756.6152" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="94" x="2166" y="1691.4971">Apply defaults</text></g><!--link ToolStep to GMN82--><g id="link_ToolStep_GMN82"><path d="M2448.29,1165.7373 C2487.96,1165.7373 2645.98,1165.7373 2750.77,1165.7373 " fill="none" id="ToolStep-GMN82" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link GMN82 to GMN86--><g id="link_GMN82_GMN86"><path d="M2879.17,1254.5273 C2879.17,1326.5373 2879.17,1427.3473 2879.17,1484.8473 " fill="none" id="GMN82-GMN86" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link Routing to FinalResponse--><g id="link_Routing_FinalResponse"><path d="M1375.25,1151.5273 C1375.25,1132.7973 1375.25,1106.7373 1375.25,1106.7373 C1375.25,1106.7373 1710.4375,1106.7373 2045.625,1106.7373 C2213.2188,1106.7373 2380.8125,1106.7373 2506.5078,1106.7373 C2569.3555,1106.7373 2621.7285,1106.7373 2658.3896,1106.7373 C2676.7202,1106.7373 2691.1228,1106.7373 2700.9427,1106.7373 C2703.3977,1106.7373 2699.5663,1106.7373 2701.4382,1106.7373 " fill="none" id="Routing-to-FinalResponse" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="2707.4382,1106.7373,2698.4382,1102.7373,2702.4382,1106.7373,2698.4382,1110.7373,2707.4382,1106.7373" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120" x="1933.78" y="1103.8071">final_response set</text></g><!--link FinalResponse to HistoryMgmt--><g id="link_FinalResponse_HistoryMgmt"><path d="M2716,1279.5405 C2716,1282.0271 2716,1284.535 2716,1287.062 C2716,1307.2775 2716,1328.7082 2716,1350.1361 C2716,1371.5639 2716,1392.9888 2716,1413.1928 C2716,1418.2438 2716,1423.2185 2716,1428.0978 C2716,1430.5375 2716,1432.9534 2716,1435.343 C2716,1436.5378 2716,1437.7261 2716,1438.9075 C2716,1439.4982 2716,1434.0872 2716,1434.6744 " fill="none" id="FinalResponse-to-HistoryMgmt" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="2716,1440.6744,2720,1431.6744,2716,1435.6744,2712,1431.6744,2716,1440.6744" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="135" x="2580" y="1347.0671">Update chat_history</text></g><!--link HistoryMgmt to MessageHandler--><g id="link_HistoryMgmt_MessageHandler"><path d="M2716,1598.8929 C2716,1599.176 2716,1599.4591 2716,1599.7424 C2716,1600.3089 2716,1600.8758 2716,1601.4429 C2716,1603.7114 2716,1605.984 2716,1608.2523 C2716,1644.5448 2716,1679.7373 2716,1679.7373 C2716,1679.7373 1827.75,1679.7373 1827.75,1679.7373 C1827.75,1679.7373 1827.75,1642.2373 1827.75,1604.7373 C1827.75,1603.5654 1827.75,1602.3936 1827.75,1601.2228 C1827.75,1600.6375 1827.75,1600.0524 1827.75,1599.4677 C1827.75,1599.1754 1827.75,1604.8832 1827.75,1604.5911 " fill="none" id="HistoryMgmt-to-MessageHandler" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="1827.75,1598.5911,1823.75,1607.5911,1827.75,1603.5911,1831.75,1607.5911,1827.75,1598.5911" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="137" x="2269.14" y="1676.8071">Return response dict</text></g><!--link GMN86 to GMN94--><g id="link_GMN86_GMN94"><path d="M2815.33,1485.2173 C2815.33,1431.3373 2815.33,1347.7373 2815.33,1347.7373 C2815.33,1347.7373 944,1347.7373 944,1347.7373 C944,1347.7373 944,1403.7373 944,1453.6073 " fill="none" id="GMN86-GMN94" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link GMN94 to GMN98--><g id="link_GMN94_GMN98"><path d="M944,1605.9273 C944,1673.1773 944,1768.9273 944,1824.5173 " fill="none" id="GMN94-GMN98" style="stroke:#000000;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link LLMHandler to PlannerAdapter--><g id="link_LLMHandler_PlannerAdapter"><path d="M276.9838,1170.7373 C276.898,1170.7373 276.8127,1170.7373 276.7281,1170.7373 C276.5588,1170.7373 276.392,1170.7373 276.2284,1170.7373 C275.5738,1170.7373 274.9691,1170.7373 274.4538,1170.7373 C273.4231,1170.7373 272.75,1170.7373 272.75,1170.7373 C272.75,1170.7373 272.75,1392.7373 272.75,1392.7373 C272.75,1392.7373 817,1392.7373 817,1392.7373 C817,1392.7373 817,1394.7462 817,1398.2775 C817,1400.0431 817,1402.1894 817,1404.6554 C817,1405.8884 817,1407.2014 817,1408.5867 C817,1408.933 817,1403.2838 817,1403.6391 " fill="none" id="LLMHandler-to-PlannerAdapter" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="817,1409.6391,821,1400.6391,817,1404.6391,813,1400.6391,817,1409.6391" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="67" x="428.12" y="1389.8071">Build tools</text></g><!--link PlannerAdapter to ToolWrappers--><g id="link_PlannerAdapter_ToolWrappers"><path d="M808.8982,1529.7373 C808.8243,1529.7373 808.75,1529.7373 808.6754,1529.7373 C808.5261,1529.7373 808.3754,1529.7373 808.2232,1529.7373 C807.9187,1529.7373 807.6084,1529.7373 807.2927,1529.7373 C806.6611,1529.7373 806.0077,1529.7373 805.335,1529.7373 C799.9538,1529.7373 793.345,1529.7373 786.925,1529.7373 C774.085,1529.7373 762,1529.7373 762,1529.7373 C762,1529.7373 762,1610.6798 762,1693.5198 C762,1714.2298 762,1735.0584 762,1754.7705 C762,1759.6985 762,1764.5568 762,1769.326 C762,1771.7105 762,1774.0729 762,1776.4105 C762,1777.5793 762,1772.7419 762,1773.8981 " fill="none" id="PlannerAdapter-to-ToolWrappers" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="762,1779.8981,766,1770.8981,762,1774.8981,758,1770.8981,762,1779.8981" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="125" x="636" y="1669.0871">Wrap each method</text></g><!--link ToolWrappers to AgentGraph--><g id="link_ToolWrappers_AgentGraph"><path d="M753.2704,1869.7373 C753.0013,1869.7373 752.7263,1869.7373 752.4456,1869.7373 C751.3227,1869.7373 750.1074,1869.7373 748.803,1869.7373 C746.1942,1869.7373 743.2293,1869.7373 739.936,1869.7373 C726.7626,1869.7373 708.3339,1869.7373 686.4203,1869.7373 C642.5931,1869.7373 584.8262,1869.7373 527.2825,1869.7373 C412.195,1869.7373 298,1869.7373 298,1869.7373 C298,1869.7373 298,1788.6748 298,1705.7123 C298,1684.9717 298,1664.1123 298,1644.3711 C298,1639.4358 298,1640.5704 298,1635.7942 " fill="none" id="ToolWrappers-to-AgentGraph" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="298,1629.7942,294,1638.7942,298,1634.7942,302,1638.7942,298,1629.7942" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123" x="236.23" y="1866.8071">StructuredTool list</text></g><!--link ToolsNode to PlannerAdapter--><g id="link_ToolsNode_PlannerAdapter"><path d="M1193.41,877.7373 C1084.74,877.7373 835.25,877.7373 835.25,877.7373 C835.25,877.7373 835.25,1040.7373 835.25,1203.7373 C835.25,1244.4873 835.25,1285.2373 835.25,1323.4404 C835.25,1342.542 835.25,1361.0068 835.25,1378.5166 C835.25,1387.2715 835.25,1395.7876 835.25,1404.0251 C835.25,1405.0548 835.25,1400.0802 835.25,1401.1011 " fill="none" id="ToolsNode-to-PlannerAdapter" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#000000" points="835.25,1407.1011,839.25,1398.1011,835.25,1402.1011,831.25,1398.1011,835.25,1407.1011" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="144" x="690.25" y="1030.6271">Execute tool methods</text></g><!--link GetResponseAPI to AgentInvoke--><g id="link_GetResponseAPI_AgentInvoke"><path d="M1814,1690.6448 C1814,1656.1402 1814,1617.5539 1814,1575.7182 C1814,1408.3754 1814,1189.0411 1814,970.9698 C1814,534.8273 1814,103.7373 1814,103.7373 C1814,103.7373 1337.8,103.7373 1264.34,103.7373 " fill="none" id="GetResponseAPI-to-AgentInvoke" style="stroke:#008000;stroke-width:1.0;"/><polygon fill="#008000" points="1258.34,103.7373,1267.34,107.7373,1263.34,103.7373,1267.34,99.7373,1258.34,103.7373" style="stroke:#008000;stroke-width:1.0;"/></g><!--SRC=[bLfjRziu4lwUNy5pW3q7JN99kxqFmku1tjHjlPSts6aFXpGG68csYSYILgJIU0_xtszcICeK9TjfyY4IEII7y_BCY_8tlHGhmSgCo_n0FScyv1LViQHObKKkSZtJwqomIYIQvujCU2HLKUTfKbIvgDZvcJUHoLpeTIbOKUbbuKqyykHfGSikYgoesE77CVuU76YfuP3BoolscUTf1Xl27pPQmFdiOrPyPz-bNhAB8jVYHREll9ByCHFguA247Vb2iC4abrhoJFx9jInoThlaIWpO_muO_3HtOOFRZEV0xs-5_fOFI_CIFnRwj5mV3HXNR4D0I_D2m-NbOgbPCGydyQTzRjICdx2BId0j5DxANcfur3DjznpTJaOfBxMeF9gfM4W5GuejpGwA9WN81XcZb_26c-FWXbcsYktIveOR0YkUzZsR8Vm1YS_begw2ondkaYNNyQf8HHQn2tZ-AYfGpsW2QgVtcrBaeqcmQCLVOWbNeXrLn2JmF4p5dDUPZjW_Z_hEM88GYceTiGyoqVTALyVi4eRkVmCTNmcbm00U7eA5gDkO6ub6EuHig7LHPC0CxJhJLPtekXBf7Oo6-oP5_Wnw8FRZIfH5X49gXgOmeYHosrhNUfcjGQShTbk1qhGAfQfeDbwPUyKhSClu4IuQCRZuRbfUoiZkRiMoczxPVqcST0zelHXd79Lbo3372JYxH4ciIfc9z5F5osL0PkmzPS-IiuIUwVnOl8YaXfS5hl4yf6NaV_MQkc693WDR9puQAwSvcjflvORi6YmvqCORPaKKcVrc6jXc9__otW9wSvlYzGl8yk8SpdxbahOf4V4Lp-7oAo0FsLVBeixI68nMoxo68m1yuMd1ic8Xau0uVWOSIr4n00zesrnMHaTWDQKQ7eNq0EhAQF4LUjjW9pk1ssrGA6BdfniODUiyZ3fneY0jHUpjwGxp-POp8z5Zfpa3KCSGm1IOJTeC86NR_ey3RFgM7ntyvKKOwrBejmayeXGnDFK46KkvWM7qNuV3gZ7HDjb-CntdkbgpsqA6UZOxnnWRdMyFGo2TYaJ8PuWtNvIe-j7Xaz2ArJ0TWrmMTPVWWcUP7pzE5qB7Hh2AqEV7tBUxciG2R4pjAE3rVh5CyhBMx1OJ386nClG1kf4LInVZxBnCjquvOH016nObMWVFGcy08rh0RLISW9GmqOb8NfYdR5iKXbfARdwhPPQ2SONNe775x4KWnr8we23z6OXtP075PS5X2uofpCRKW6169b2oIxZpR8Kvbwvu0jpiYmkJ_Bb8UhA4DqsUinK1SUaJ43Hnv5JIo50XSIXcwtr03yA6d25MhIstcLtWQmWgRJkBMCSS4I9yupbk1cIwUNRc4SA5ZV8EDJgvQmzk14kQH8JSmiPrjTZl4MWgcZskMOntwaaeXaVHTeLERox7x2TsEvxERgv7bvEx_uOH7_CkLeAheKbBlMO6G0EgEwwU059TQ88xAB0v3azLaUs8QHz6TtZ-tUHgtCauwwf28w4W1TuO0TO2gFFrCVkTvpK7U3n_VypUdhrzFzYoLCkLMth-S_JkRB2TaI-pyPHDhZ_UX6niHOmJDfULqd4EK6JXOWwYOKfeZBhgQCzXjzERgybiF6D3cMEcYHPp59wEmfPWeeW0S8lRypD8Z0i6Xbj13BizEuy0x3b2o63BoWGgC6rJRpbdl_pAtf_jO6qwlXXVtx6Bc-klO1EZkydDTRGhArRrQiKnNU-Avv8hpTwro1bOUAwsdtuvklxqPVHfpAv6r_3d2bZfrSS6fWSY7s0DCfXNzYyVTFWmn203HLw60Vz7OfVpKQmOqBURNKnaLmkQsEkfTXk0RTnL5mO4TpWdf4gj19yDqPyRMsdHlktGOZobzAXD-EuKJ4CMbIkqsF1p3Ovhb_rZDB5FxLK_dpAVZ0sjYxKmStz248HxHEO6wg8T27QmAQKG576T5NjaOcKxLFhGR4AMoPrtuR6NZm_lrgL8iVxqoWipjLV9mK5XWBHiklBJBse3oYOt9T_jgLGYTcCJZNlQAmL-7y9TC9a7z7hfssGkOMqJ1RtjmBuV-akZM5GLrZixIK7vW4UWGStZnxKvlLb0LJtmSinw-NMBammaE9SsozWifqKzLHLS0_9b0tOgF8wQ272cTrfWe5s3CMNYc0eE1AujsRyjTAYUz5jA-BwzfzJCDYdjnavUPoDlM5ZFzxS2ceTD8UCVPTAnTld4XdaH0iSRJBaX3_WTiWIYzcQ-sa8ImhWf8ydeL9U5cre7DpLcJBT4oSnWNUkAVPQ46ZtOPiInd4Dv7TiEZmj9ErjeOrl4RrJeHhRei3Djt5wKMsGCcESI4f8Ceom1htxllDE_zCLI94z4UFeaSyWx1dWR4zjiNMjU8EEA4Nq7NKbZBujOyla0u2soPr9s8fP5bcAhSVWHif1uDXvDBpuVCtgvkxcvz3LlSdhM10RJdYMdm-f7UQIZz9ddYMXGfykPGV-qmvmrnA1mRqanHpmKWS9_wF0HvAXO4NTEXqees9VzolweXKBN3-Xw4MeV6pij4BMbDkP7hrjihptNgBg1AVzIPb2GfboLnQj5owjDYSGGF2Ka9aCe07CbaIi2UjLZ1tXWon9CQTQLzXXtC2S47d71TR9auYKHPJiNQmwXq_sZF98hNZqHnsigjo6dRRZUB-kfRObTOakCn6r7UeJjp-1Fq5_pwohdje4HYHU0DjMXQa8x-oLeGtL8brp5lQw6p0aB3ie0Wcj7qjlu-iCMQL1yi_w6YPGNaoBNccERGjkR9d8V_YA2CTkYIudSdoRwncGZl4o86yqiqLg9HqHbswjsNwUuBWjE7rsowmyHIq7nhV1E3aDOQ0BxJtZ31X3xGxoRzjQvOE-cOEOLoM5TOk4cqjQPEoe03vsZJe-Fu5oPS99XhQK4hv9bR2i_5NgcxUkXNS4gi16CL1ccsEYE6De3ql4BDeIqQcf9cUvX5MD7H2gcgdWkHPQ-Wd5ITq7fGK1CQOSoUGVHzs52m2sTofvvLeiVgV9cKCTgzi5ydLAc3OD3RkGrpSav01TeTrGjQco3x5AjwKsKM052eNVMV1SBUxcZiimaxFbzAN86Mb0x6tGRJKM-yOHxWlUSp6MMmRwsPu6MOmr61TGVgHECNKugMctQWS3BLuzoKHVr_ceQrKOvaaKSpssYtip4OO_lNrGk-Yg9I3fhPaMdMexk2aqlBUlnxe-8sCpHajPfg5czL-jJWKqDoaknvgZMEvG-htEY8WJizaoQQOpJ4LL8hVacpTK5wQ2xWyDCJ9TDUu4zWkZRbjT0iCczkvF65Lq1qgdnb2vA279SOMaMSh2bWclTvHNU-Dbs9pQVkqWtTlXgiNf5mmM_IxiLEvHoWZsTL81SKpJm_dO8A_9i7Ipxju0wno3O-TkUrjO999e5ua49xcBxY7jbu4UmbYL6ONQXXBbksrvndIUbY7qfgJhpFwxJCb-Kr51fTSqZPzVDSQJ1JYITv5eiJFQolJpUV8htQsGxj5-FesSkpRSLIXTsgfAdgGk0dSzYGNpipEDQJWxOcSBErDPrEFbTYATiJVyaKEaEHLsQBhPf3NUcJqzFsH0SafNrOoOJ1WNliaZL3trW8styf-9bIMcCBIJSm7uXRzPtlaS5tCRVWOgoKaY1eTv9bJDkrveC5xX-VDDBlri2VAGdMP5GhbbKtN0UAuwvw9_2hSB3Pdmkz7glM88locrxSnr3ofpz5DVPeyjQdUmY4WiJ72AaqKmJqXhnXX-ks_zNilc0ryvtGyRyaiqP0RhStnd-OnO6VlzczuUFaE8yj4u-23kizuUBIeYyeJA9_q6h2BW_BEkgp6WhlqFLIltl3q5B-OA8MYsGTiP_VmXtVl3p_eF_0m00]--></g></svg>